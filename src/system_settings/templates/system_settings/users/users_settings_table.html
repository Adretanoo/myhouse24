{% extends "base_adminlte.html" %}
{% load static %}
{% block head %}
    <title>Пользователи</title>
    <meta name="description" content="Пользователи">
    <meta name="keywords" content="Пользователи">
    <link rel="stylesheet"
          href="//cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <link rel="stylesheet"
          href="{% static 'adminlte/dist/css/users_settings.css' %}">
{% endblock head %}
{% block title %}
    <h1>Пользователи</h1>
{% endblock title %}
{% block breadcrumbs %}
{% endblock breadcrumbs %}
{% block content %}
    <div class="row">
        <div class="col-xs-12 col-lg-12">
            <div class="pull-right mb-4">
                <a class="btn btn-success" href="{% url 'users_add' %}">Создать пользователя</a>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-12 col-lg-12">
            <div class="box">
                <div class="box-header with-border">
                    <h3 class="box-title"></h3>
                    <div class="box-tools">
                        <a href="{% url 'users' %}" class="btn btn-default btn-sm">
                            <span class="hidden-xs">Очистить</span>
                        </a>
                    </div>
                </div>
                <div id="w0" class="grid-view">
                    <div class="box-body table-responsive no-padding">
                        <table id="ajax_users" class="table table-bordered table-striped">
                            <thead>
                                <tr role="row">
                                    <th>#</th>
                                    <th>Пользователь</th>
                                    <th>Роль</th>
                                    <th>Телефон</th>
                                    <th>Email (логин)</th>
                                    <th>Статус</th>
                                    <th></th>
                                </tr>
                                <tr>
                                    <th></th>
                                    <th>{{ filters.name }}</th>
                                    <th>{{ filters.job_title }}</th>
                                    <th>{{ filters.phone_number }}</th>
                                    <th>{{ filters.email }}</th>
                                    <th>{{ filters.status }}</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="loading_tr">
                                    <td colspan="3">Loading...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="box-footer clearfix"></div>
                </div>
            </div>
        </div>
    </div>
    <form id="deleteForm" method="post">
        {% csrf_token %}
    </form>
{% endblock content %}
{% block scripts %}
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="//cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script>
        $(document).ready(function () {
            let table = $('#ajax_users').DataTable({
                serverSide: false,
                processing: false,
                info: false,
                autoWidth: true,
                lengthChange: false,
                pageLength: 10,
                ajax: {
                    url: "{% url 'ajax_users' %}",
                    data: function (d) {
                        d.name = $('#filter_name').val();
                        d.email = $('#filter_email').val();
                        d.phone_number = $('#filter_phone').val();
                        d.job_title = $('#filter_job_title').val();
                        d.status = $('#filter_status').val();
                    }
                },
                columns: [
                    {data: "id"},
                    {data: "full_name"},
                    {data: "job_title"},
                    {data: "phone_number"},
                    {data: "email"},
                    {data: "status"},
                    {data: "actions", orderable: false, searchable: false}
                ],
                paging: true,
                searching: false,
                ordering: false,
                language: {
                    search: "",
                    emptyTable: "Ничего не найдено.",
                    paginate: {
                        previous: "«",
                        next: "»"
                    }
                },
            });

            $('#filter_name, #filter_email, #filter_phone, #filter_job_title, #filter_status').on('keyup change', function () {
                table.ajax.reload();
            });
        });
    </script>
    <script src="{% static 'adminlte/dist/js/table_item_delete.js' %}" defer></script>
{% endblock scripts %}
